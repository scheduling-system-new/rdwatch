<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>名錶雷達站 RD-WATCH 線上排班系統</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>

    <style>
        /* --- 核心配色 --- */
        :root {
            --color-primary-dark: #121212; 
            --color-accent-red: #D9534F;
            --color-light-gray: #F4F4F4;
        }

        /* --- Banner 樣式 (置頂、滿版) --- */
        .banner-container {
            width: 100%;
            /* 移除固定高度，讓圖片依比例撐開，或設定最大高度 */
            position: relative;
            background-color: var(--color-primary-dark);
            line-height: 0; /* 消除圖片下方的間隙 */
        }
        
        .banner-image {
            width: 100%;
            height: auto; /* 自動高度，保持比例 */
            max-height: 250px; /* 限制最大高度，避免在電腦版過大 */
            object-fit: cover; /* 確保填滿 */
            object-position: center;
            display: block;
        }

        /* --- 下拉選單自定義箭頭 --- */
        .custom-select {
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3e%3cpath fill='none' stroke='%23666' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M2 5l6 6 6-6'/%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 0.5rem center;
            background-size: 1em 1em;
            padding-right: 2rem !important;
        }

        /* --- 滾動條隱藏 (美觀用) --- */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        
        /* --- 菜單動畫 --- */
        .slide-enter-active, .slide-leave-active {
            transition: transform 0.3s ease-out;
        }
        .slide-enter-from, .slide-leave-to {
            transform: translateX(100%);
        }
    </style>
</head>

<body class="bg-white text-gray-800 antialiased">

<div id="app" class="max-w-screen-md mx-auto min-h-screen bg-white shadow-xl relative">

    <div class="banner-container">
        <img src="./線上排班系統Benner.jpg" alt="Banner" class="banner-image">
    </div>

    <main class="p-4">
        
        <section v-if="currentPage === '當月班表'">
            
            <div class="flex justify-between items-center mb-4">
                <div class="flex items-baseline">
                    <h2 class="text-3xl font-bold text-gray-700 mr-3">當月班表</h2>
                    
                    <div class="relative">
                        <select v-model="selectedMonthKey" 
                                class="custom-select appearance-none bg-transparent text-xl font-medium text-gray-600 border-none focus:ring-0 cursor-pointer pr-6">
                            <option v-for="key in monthKeys" :value="key" :key="key">
                                {{ key.replace('-', '年') }}月
                            </option>
                        </select>
                    </div>
                </div>

                <button @click="toggleMenu" class="p-2 rounded-md hover:bg-gray-100 text-gray-400">
                    <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                    </svg>
                </button>
            </div>

            <div class="flex bg-gray-200 rounded-full p-1 mb-6">
                <button 
                    @click="isWorkingMode = true"
                    :class="{'bg-white shadow text-gray-800': isWorkingMode, 'text-gray-500 hover:text-gray-700': !isWorkingMode}"
                    class="flex-1 py-2 rounded-full text-lg font-medium transition-all duration-200">
                    值班人員
                </button>
                <button 
                    @click="isWorkingMode = false"
                    :class="{'bg-white shadow text-gray-800': !isWorkingMode, 'text-gray-500 hover:text-gray-700': isWorkingMode}"
                    class="flex-1 py-2 rounded-full text-lg font-medium transition-all duration-200">
                    休假人員
                </button>
            </div>

            <div class="space-y-8">
                
                <div>
                    <div class="flex items-center mb-2">
                        <div class="bg-yellow-300 px-3 py-1 font-bold text-lg text-gray-800 mr-2">
                            台北店
                        </div>
                        <span class="text-gray-500 text-sm">人數：{{ taipeiStaff.length }}</span>
                    </div>

                    <CalendarView 
                        :staff="taipeiStaff" 
                        :is-working-mode="isWorkingMode" 
                        :year="currentYear"
                        :month="currentMonth"
                        :mock-schedules="mockSchedules"
                        :staff-limits="staffLimits"
                    />
                </div>

                <div>
                    <div class="flex items-center mb-2">
                        <div class="bg-yellow-300 px-3 py-1 font-bold text-lg text-gray-800 mr-2">
                            台中店
                        </div>
                        <span class="text-gray-500 text-sm">人數：{{ taichungStaff.length }}</span>
                    </div>

                    <CalendarView 
                        :staff="taichungStaff" 
                        :is-working-mode="isWorkingMode" 
                        :year="currentYear"
                        :month="currentMonth"
                        :mock-schedules="mockSchedules"
                        :staff-limits="staffLimits"
                    />
                </div>

            </div>
        </section>

        <section v-if="currentPage === '我要排班'">
             <ScheduleRequest 
                :staff-limits="staffLimits" 
                :taipei-staff="taipeiStaff" 
                :taichung-staff="taichungStaff" 
                :month-keys="monthKeys"
                @update-schedule="updateMockSchedules"
                @goto-home="navigateTo('當月班表')" 
            />
        </section>

        <section v-if="currentPage === '我要請假'">
            <LeaveRequest @update-schedule="updateMockSchedules" @goto-home="navigateTo('當月班表')" />
        </section>

    </main>

    <div class="fixed bottom-6 right-0 left-0 flex justify-center pointer-events-none">
        <button @click="scrollToTop" class="pointer-events-auto flex flex-col items-center text-gray-400 hover:text-gray-600 transition">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7"></path></svg>
            <span class="text-xs">返回頂端</span>
        </button>
    </div>

    <transition name="slide">
        <div v-if="isMenuOpen" class="fixed inset-0 z-50 flex justify-end">
            <div @click="toggleMenu" class="absolute inset-0 bg-black bg-opacity-30"></div>
            
            <div class="relative w-64 bg-white h-full shadow-2xl p-6 flex flex-col">
                <button @click="toggleMenu" class="self-end mb-6 text-gray-500">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
                
                <ul class="space-y-4 text-lg font-medium text-gray-700">
                    <li><button @click="navigateTo('當月班表')" class="w-full text-left py-2 border-b">首頁</button></li>
                    <li><button @click="navigateTo('我要排班')" class="w-full text-left py-2 border-b">我要排班</button></li>
                    <li><button @click="navigateTo('我要請假')" class="w-full text-left py-2 border-b">我要請假</button></li>
                </ul>
            </div>
        </div>
    </transition>

</div>

<script type="module">
    const { createApp, ref, computed } = Vue;

    /* --- 月曆顯示組件 (包含下方的統計表) --- */
    const CalendarView = {
        props: ['staff', 'isWorkingMode', 'year', 'month', 'mockSchedules', 'staffLimits'],
        template: `
            <div class="w-full">
                <div class="border border-gray-200 rounded-sm mb-4">
                    <div class="grid grid-cols-7 border-b border-gray-200 bg-gray-50">
                        <div v-for="day in ['日','一','二','三','四','五','六']" :key="day" 
                             class="py-2 text-center text-gray-500 font-bold text-sm">
                            {{ day }}
                        </div>
                    </div>
                    <div class="grid grid-cols-7">
                         <div v-for="i in startPadding" :key="'pad'+i" class="h-24 border-b border-r border-gray-100 bg-gray-50/30"></div>
                        
                        <div v-for="day in monthDays" :key="day" 
                             class="h-24 border-b border-r border-gray-200 relative p-1 bg-white hover:bg-gray-50 transition-colors">
                            
                            <div class="text-right text-sm font-semibold mb-1" :class="{'text-red-500': isSunday(day)}">
                                {{ day }}
                            </div>

                            <div class="flex flex-col gap-0.5 overflow-hidden">
                                <div v-for="item in getDailyStaff(day)" :key="item.id" 
                                     class="text-xs px-1 rounded truncate"
                                     :class="item.styleClass">
                                    {{ item.name }}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="border border-gray-200 text-sm">
                    <div class="grid grid-cols-6 bg-gray-50 border-b border-gray-200 font-bold text-gray-600 text-xs py-2 text-center">
                        <div class="col-span-1">人員</div>
                        <div class="col-span-1">可休天數</div>
                        <div class="col-span-1">排休天數</div>
                        <div class="col-span-1">事假天數</div>
                        <div class="col-span-1">病假天數</div>
                        <div class="col-span-1">加班天數</div>
                    </div>
                    <div v-for="(stat, index) in staffStats" :key="stat.id" 
                         class="grid grid-cols-6 border-b border-gray-100 py-2 text-center text-xs text-gray-700"
                         :class="{'bg-gray-50': index % 2 === 1}"> <div class="col-span-1 font-medium">{{ stat.name }}</div>
                        <div class="col-span-1">{{ stat.maxOffDays }}</div>
                        <div class="col-span-1 text-blue-600">{{ stat.scheduledOffDays }}</div>
                        <div class="col-span-1 text-red-500">{{ stat.personalLeave }}</div>
                        <div class="col-span-1 text-red-500">{{ stat.sickLeave }}</div>
                        <div class="col-span-1 text-green-600">{{ stat.overtimeDays }}</div>
                    </div>
                </div>
            </div>
        `,
        setup(props) {
            // 計算當月天數
            const monthDays = computed(() => new Date(props.year, props.month, 0).getDate());
            // 計算第一天星期幾
            const startPadding = computed(() => new Date(props.year, props.month - 1, 1).getDay());

            const isSunday = (day) => new Date(props.year, props.month - 1, day).getDay() === 0;

            // 取得某一天的顯示人員 (根據 值班/休假 模式)
            const getDailyStaff = (day) => {
                const dateKey = `${props.year}-${props.month}-${day}`;
                const result = [];

                props.staff.forEach(emp => {
                    // 查找該員工當天的排程
                    const schedule = props.mockSchedules.find(s => s.employeeId === emp.id && s.date === dateKey);
                    
                    let status = 'Working'; // 預設值班
                    let label = emp.name;
                    let styleClass = 'text-gray-700'; // 預設黑色文字

                    if (schedule) {
                        if (schedule.type === 'GeneralOff' || schedule.type === 'SpecialAnnual') {
                            status = 'Off';
                            styleClass = 'text-gray-400'; // 排休顯示灰色 (或不顯示，視邏輯)
                        } else if (schedule.type === 'Leave' || (schedule.type === 'Personal' && schedule.isExtra)) {
                            status = 'Leave';
                            const typeMap = { 'Sick': '病', 'Personal': '事' };
                            const typeLabel = typeMap[schedule.leaveType] || '假';
                            label = `${emp.name}(${typeLabel})`;
                            styleClass = 'text-red-500 font-bold'; // 請假顯示紅色
                        }
                    }

                    // 邏輯判斷：根據 isWorkingMode 決定是否加入 result
                    if (props.isWorkingMode) {
                        // 值班人員模式：顯示 "Working" 狀態的人 (沒有排休且沒有請假)
                        // 若要顯示請假的人但標紅，也可保留
                        if (status === 'Working') {
                            result.push({ id: emp.id, name: emp.name, styleClass: 'text-gray-800' });
                        } else if (status === 'Leave') {
                             result.push({ id: emp.id, name: label, styleClass });
                        }
                    } else {
                        // 休假人員模式：顯示 "Off" 和 "Leave" 的人
                        if (status === 'Off') {
                            result.push({ id: emp.id, name: emp.name, styleClass: 'text-gray-500' });
                        } else if (status === 'Leave') {
                            result.push({ id: emp.id, name: label, styleClass });
                        }
                    }
                });
                return result;
            };

            // 統計數據計算
            const staffStats = computed(() => {
                return props.staff.map(emp => {
                    const maxOffDays = props.staffLimits[emp.name] || 0;
                    const prefix = `${props.year}-${props.month}-`;
                    
                    // 篩選該員工當月排程
                    const schedules = props.mockSchedules.filter(s => s.employeeId === emp.id && s.date.startsWith(prefix));

                    // 1. 排休天數
                    const scheduledOffDays = schedules.filter(s => s.type === 'GeneralOff' || s.type === 'SpecialAnnual').length;
                    
                    // 2. 病假
                    const sickLeave = schedules.filter(s => s.leaveType === 'Sick').length;
                    
                    // 3. 事假 (包含主動請事假 + 超額轉事假)
                    const personalLeave = schedules.filter(s => 
                        s.leaveType === 'Personal' || (s.type === 'Personal' && s.isExtra)
                    ).length;

                    // 4. 加班 (可休 - 排休，若小於0則為0)
                    let overtimeDays = 0;
                    if (scheduledOffDays < maxOffDays) {
                        overtimeDays = maxOffDays - scheduledOffDays;
                    }

                    return {
                        id: emp.id,
                        name: emp.name,
                        maxOffDays,
                        scheduledOffDays,
                        sickLeave,
                        personalLeave,
                        overtimeDays
                    };
                });
            });

            return { monthDays, startPadding, isSunday, getDailyStaff, staffStats };
        }
    };

    /* --- 我要排班組件 --- */
    const ScheduleRequest = {
        props: ['staffLimits', 'taipeiStaff', 'taichungStaff', 'monthKeys'],
        emits: ['updateSchedule', 'gotoHome'],
        template: `
            <div class="px-2">
                <h2 class="text-2xl font-bold mb-6 text-gray-700">我要排班</h2>
                
                <div v-if="step === 1" class="space-y-6">
                    <div>
                        <label class="block text-lg font-bold mb-2 text-gray-600">1. 選擇月份</label>
                        <select v-model="selectedMonth" class="w-full p-3 border border-gray-300 rounded bg-white text-lg">
                            <option :value="null" disabled>請選擇</option>
                            <option v-for="key in monthKeys" :value="key">{{ key }}</option>
                        </select>
                    </div>
                    <div v-if="selectedMonth">
                        <label class="block text-lg font-bold mb-2 text-gray-600">2. 選擇分店</label>
                        <div class="grid grid-cols-2 gap-4">
                            <button @click="selectLoc('Taipei')" class="py-4 bg-gray-800 text-white rounded hover:bg-gray-700 text-lg">台北店</button>
                            <button @click="selectLoc('Taichung')" class="py-4 bg-gray-800 text-white rounded hover:bg-gray-700 text-lg">台中店</button>
                        </div>
                    </div>
                </div>

                <div v-if="showPicker" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-end">
                    <div class="bg-white w-full rounded-t-xl p-6 pb-10 animate-slide-up">
                        <div class="flex justify-between items-center mb-4 border-b pb-2">
                            <h3 class="text-xl font-bold">選擇人員</h3>
                            <button @click="showPicker=false" class="text-gray-500 text-lg">取消</button>
                        </div>
                        <div class="overflow-y-auto max-h-60 text-center space-y-2">
                            <div v-for="emp in currentStaffList" :key="emp.id" 
                                 @click="confirmStaff(emp)"
                                 class="py-3 text-lg font-medium text-gray-700 hover:bg-gray-100 rounded cursor-pointer">
                                {{ emp.name }}
                            </div>
                        </div>
                    </div>
                </div>

                <div v-if="step === 3">
                    <div class="flex justify-between items-center mb-4 bg-gray-100 p-3 rounded">
                        <span class="font-bold text-lg">{{ selectedEmp.name }}</span>
                        <div class="text-sm text-right">
                            <div>可休: {{ maxOff }}</div>
                            <div :class="remaining < 0 ? 'text-red-500' : 'text-blue-600'">剩餘: {{ remaining }}</div>
                        </div>
                    </div>

                    <div class="grid grid-cols-7 gap-1 mb-6">
                        <div v-for="d in daysInMonth" :key="d" 
                             @click="toggleDate(d)"
                             class="aspect-square flex items-center justify-center border rounded cursor-pointer relative"
                             :class="getDateClass(d)">
                            {{ d }}
                            <span v-if="getDateType(d)" class="absolute bottom-1 text-[10px]">
                                {{ getDateType(d) === 'GeneralOff' ? '休' : '事' }}
                            </span>
                        </div>
                    </div>

                    <button @click="submit" class="w-full py-3 bg-red-500 text-white text-xl font-bold rounded shadow hover:bg-red-600">
                        確認送出
                    </button>
                </div>
            </div>
        `,
        setup(props, { emit }) {
            const step = ref(1);
            const selectedMonth = ref(null);
            const selectedLoc = ref(null);
            const showPicker = ref(false);
            const currentStaffList = ref([]);
            const selectedEmp = ref(null);
            const selectedDates = ref([]); // { date: 'YYYY-M-D', type: 'GeneralOff' | 'Personal' }
            const maxOff = ref(0);

            const daysInMonth = computed(() => {
                if(!selectedMonth.value) return 0;
                const [y, m] = selectedMonth.value.split('-');
                return new Date(y, m, 0).getDate();
            });

            const remaining = computed(() => {
                const offCount = selectedDates.value.filter(d => d.type === 'GeneralOff').length;
                return maxOff.value - offCount;
            });

            const selectLoc = (loc) => {
                selectedLoc.value = loc;
                currentStaffList.value = loc === 'Taipei' ? props.taipeiStaff : props.taichungStaff;
                showPicker.value = true;
            };

            const confirmStaff = (emp) => {
                selectedEmp.value = emp;
                maxOff.value = props.staffLimits[emp.name] || 0;
                selectedDates.value = [];
                showPicker.value = false;
                step.value = 3;
            };

            const getDateType = (day) => {
                const dateKey = `${selectedMonth.value}-${day}`;
                const found = selectedDates.value.find(d => d.date === dateKey);
                return found ? found.type : null;
            };

            const getDateClass = (day) => {
                const type = getDateType(day);
                if (type === 'GeneralOff') return 'bg-green-100 border-green-500 text-green-800 font-bold';
                if (type === 'Personal') return 'bg-red-100 border-red-500 text-red-800 font-bold';
                return 'bg-white border-gray-200';
            };

            const toggleDate = (day) => {
                const dateKey = `${selectedMonth.value}-${day}`;
                const idx = selectedDates.value.findIndex(d => d.date === dateKey);
                
                if (idx > -1) {
                    selectedDates.value.splice(idx, 1);
                } else {
                    // 判斷是否超過額度
                    if (remaining.value <= 0) {
                        if (confirm('可休天數已滿，此日期將記為「事假」，確定嗎？')) {
                            selectedDates.value.push({ date: dateKey, type: 'Personal', isExtra: true });
                        }
                    } else {
                        selectedDates.value.push({ date: dateKey, type: 'GeneralOff' });
                    }
                }
            };

            const submit = () => {
                if (selectedDates.value.length === 0) return alert('未選擇日期');
                selectedDates.value.forEach(d => {
                    emit('updateSchedule', {
                        employeeId: selectedEmp.value.id,
                        date: d.date,
                        type: d.type,
                        leaveType: d.type === 'Personal' ? 'Personal' : undefined,
                        isExtra: d.isExtra
                    });
                });
                alert('已送出排班');
                emit('gotoHome');
            };

            return { 
                step, selectedMonth, showPicker, currentStaffList, selectedEmp, daysInMonth, maxOff, remaining,
                selectLoc, confirmStaff, toggleDate, getDateClass, getDateType, submit
            };
        }
    };

    /* --- 我要請假組件 (簡易版) --- */
    const LeaveRequest = {
        emits: ['updateSchedule', 'gotoHome'],
        template: `
            <div class="px-2">
                <h2 class="text-2xl font-bold mb-6 text-gray-700">我要請假</h2>
                <div class="bg-gray-100 p-4 rounded mb-6 text-sm text-gray-600">
                    模擬登入身分：Aaron (台北店)
                </div>
                
                <div class="space-y-4">
                    <div>
                        <label class="block font-bold mb-1">日期</label>
                        <input type="date" v-model="date" class="w-full p-3 border rounded">
                    </div>
                    <div>
                        <label class="block font-bold mb-1">假別</label>
                        <div class="flex gap-4">
                            <label class="flex items-center"><input type="radio" value="Sick" v-model="type" class="mr-2">病假</label>
                            <label class="flex items-center"><input type="radio" value="Personal" v-model="type" class="mr-2">事假</label>
                        </div>
                    </div>
                    <button @click="submit" class="w-full py-3 bg-red-500 text-white font-bold rounded mt-4">送出請假</button>
                </div>
            </div>
        `,
        setup(props, { emit }) {
            const date = ref('');
            const type = ref('Sick');
            const submit = () => {
                if (!date.value) return alert('請選擇日期');
                // 日期格式轉換
                const [y, m, d] = date.value.split('-');
                const formattedDate = `${parseInt(y)}-${parseInt(m)}-${parseInt(d)}`;

                emit('updateSchedule', {
                    employeeId: 'E001', // 固定 Aaron
                    date: formattedDate,
                    type: 'Leave',
                    leaveType: type.value
                });
                alert('請假申請已送出');
                emit('gotoHome');
            };
            return { date, type, submit };
        }
    };

    /* --- 主程式 --- */
    createApp({
        components: { CalendarView, ScheduleRequest, LeaveRequest },
        setup() {
            // 初始化數據
            const now = new Date();
            const currentYear = ref(now.getFullYear());
            const currentMonth = ref(now.getMonth() + 1);
            const selectedMonthKey = ref(`${currentYear.value}-${currentMonth.value}`);
            
            const currentPage = ref('當月班表');
            const isMenuOpen = ref(false);
            const isWorkingMode = ref(true);

            // 生成月份 Key
            const monthKeys = [];
            let y = currentYear.value, m = currentMonth.value;
            // 生成到 2026/6
            while (y < 2026 || (y === 2026 && m <= 6)) {
                monthKeys.push(`${y}-${m}`);
                m++;
                if (m > 12) { m = 1; y++; }
            }

            // 人員數據
            const staffLimits = { 'Aaron': 5, '百九': 5, '淳淳': 5, '小樂': 8, '卡比獸': 5, 'Yumi': 7, 'Bebe': 8, '彥筑': 8, '小夏': 8, '阿泓': 5, '晏庭': 8, '美樂蒂': 8 };
            const staff = [
                { id: 'E001', name: 'Aaron', location: 'Taipei' },
                { id: 'E002', name: '百九', location: 'Taipei' },
                { id: 'E003', name: '淳淳', location: 'Taipei' },
                { id: 'E004', name: '小樂', location: 'Taipei' },
                { id: 'E005', name: '卡比獸', location: 'Taichung' },
                { id: 'E006', name: 'Yumi', location: 'Taichung' },
                { id: 'E007', name: 'Bebe', location: 'Taichung' },
                { id: 'E008', name: '彥筑', location: 'Taichung' },
                { id: 'E009', name: '小夏', location: 'Taichung' },
                { id: 'E010', name: '阿泓', location: 'Taichung' },
                { id: 'E011', name: '晏庭', location: 'Taichung' },
                { id: 'E012', name: '美樂蒂', location: 'Taichung' }
            ];

            // 模擬資料庫
            const mockSchedules = ref([
                { employeeId: 'E001', date: `${currentYear.value}-${currentMonth.value}-5`, type: 'GeneralOff' },
                { employeeId: 'E002', date: `${currentYear.value}-${currentMonth.value}-6`, type: 'Leave', leaveType: 'Sick' }
            ]);

            const taipeiStaff = computed(() => staff.filter(s => s.location === 'Taipei'));
            const taichungStaff = computed(() => staff.filter(s => s.location === 'Taichung'));

            // 監聽月份切換
            Vue.watch(selectedMonthKey, (newVal) => {
                const [y, m] = newVal.split('-');
                currentYear.value = parseInt(y);
                currentMonth.value = parseInt(m);
            });

            // 方法
            const toggleMenu = () => isMenuOpen.value = !isMenuOpen.value;
            const navigateTo = (page) => {
                currentPage.value = page;
                isMenuOpen.value = false;
                window.scrollTo(0, 0);
            };
            const scrollToTop = () => window.scrollTo({ top: 0, behavior: 'smooth' });
            
            const updateMockSchedules = (data) => {
                const idx = mockSchedules.value.findIndex(s => s.employeeId === data.employeeId && s.date === data.date);
                if (idx > -1) mockSchedules.value[idx] = data;
                else mockSchedules.value.push(data);
            };

            return {
                currentYear, currentMonth, selectedMonthKey, monthKeys,
                currentPage, isMenuOpen, isWorkingMode,
                staff, taipeiStaff, taichungStaff, staffLimits, mockSchedules,
                toggleMenu, navigateTo, scrollToTop, updateMockSchedules
            };
        }
    }).mount('#app');
</script>

</body>
</html>
