<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åéŒ¶é›·é”ç«™ RD-WATCH ç·šä¸Šæ’ç­ç³»çµ±</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>

    <style>
        /* å®šç¾©ä¸»é¡Œé…è‰² */
        :root {
            --color-primary-dark: #121212; /* Banner åº•éƒ¨å»¶ä¼¸è‰² */
            --color-accent-red: #D9534F;   /* ä½å½©åº¦ç´…è‰²æŒ‰éˆ• */
            --color-light-gray: #F4F4F4;
        }

        /* æ“´å±• Tailwind CSS é…ç½® */
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'dark-bg': 'var(--color-primary-dark)',
                        'accent-red': 'var(--color-accent-red)',
                    }
                }
            }
        }

        /* åœ“å¼§éŠœæ¥æ•ˆæœ */
        .curved-banner-container {
            /* ç‚ºäº†å®¹ç´åœ“å¼§ï¼Œçµ¦äºˆåº•éƒ¨é¡å¤–ç©ºé–“ */
            padding-bottom: 50px;
        }

        .curved-background-shape {
            content: '';
            position: absolute;
            bottom: -50px; /* å‘ä¸Šæ‹‰å‹•åœ“å¼§çš„åŠå¾‘ */
            left: 0;
            right: 0;
            height: 100px; /* åœ“å¼§é«˜åº¦ */
            background-color: white; /* è®“å…§å®¹å€åŸŸèƒŒæ™¯è‰²ç‚ºç™½è‰² */
            border-top-left-radius: 50% 50%; /* åœ“å¼§åŠå¾‘ */
            border-top-right-radius: 50% 50%;
            z-index: 10; /* ç¢ºä¿åœ“å¼§åœ¨å…§å®¹ä¸Šæ–¹ */
        }
        
        .main-content-wrapper {
            background-color: white;
            position: relative;
            z-index: 20; /* ç¢ºä¿å…§å®¹å€å¡Šåœ¨åœ“å¼§ä¸Šæ–¹ */
            margin-top: -50px; /* è² é‚Šè·å‘ä¸Šæ‹‰å‹•é‡ç–Š */
            padding-top: 20px;
        }

        /* èœå–®å‹•ç•« */
        .slide-enter-active, .slide-leave-active {
            transition: transform 0.3s ease-out;
        }
        .slide-enter-from, .slide-leave-to {
            transform: translateX(100%);
        }
    </style>
</head>

<body class="bg-light-gray text-gray-800 antialiased">

<div id="app" class="max-w-screen-md mx-auto shadow-xl min-h-screen bg-white">
    <header class="p-4 flex justify-between items-center fixed top-0 left-0 right-0 max-w-screen-md mx-auto z-50 bg-white shadow-md">
        <h1 class="text-lg font-semibold text-dark-bg">åéŒ¶é›·é”ç«™</h1>
        <button @click="toggleMenu" class="p-2">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
            </svg>
        </button>
    </header>

    <main class="pt-16">
        <div class="curved-banner-container relative overflow-hidden h-[250px] bg-dark-bg">
            <img src="./ç·šä¸Šæ’ç­ç³»çµ±Benner.jpg" alt="ç·šä¸Šæ’ç­ç³»çµ± Banner" 
                 class="w-full h-[250px] object-cover object-center opacity-90">
            <div class="curved-background-shape"></div>
        </div>

        <div class="main-content-wrapper">
            <section v-if="currentPage === 'ç•¶æœˆç­è¡¨'" class="p-4">
                <h2 class="text-2xl font-bold mb-4">ç•¶æœˆç­è¡¨</h2>
                
                <div class="text-center my-4 p-2 bg-light-gray rounded-lg">
                    <p class="text-xl font-medium">{{ currentYear }} å¹´ {{ currentMonth }} æœˆ</p>
                </div>

                <div class="flex justify-around bg-gray-100 p-1 rounded-full mb-6 shadow-inner">
                    <button 
                        @click="isWorkingMode = true"
                        :class="{'bg-white shadow-md text-dark-bg': isWorkingMode, 'text-gray-500': !isWorkingMode}"
                        class="flex-1 py-2 rounded-full font-medium transition duration-200">
                        å€¼ç­äººå“¡
                    </button>
                    <button 
                        @click="isWorkingMode = false"
                        :class="{'bg-white shadow-md text-dark-bg': !isWorkingMode, 'text-gray-500': isWorkingMode}"
                        class="flex-1 py-2 rounded-full font-medium transition duration-200">
                        ä¼‘å‡äººå“¡
                    </button>
                </div>

                <div class="grid grid-cols-1 gap-6">
                    <div class="p-4 border border-gray-100 rounded-lg shadow-sm">
                        <h3 class="text-lg font-bold flex justify-between items-center mb-3">
                            å°åŒ—åº—ç­è¡¨
                            <span class="text-sm text-gray-500">å“¡å·¥äººæ•¸: {{ taipeiStaff.length }}</span>
                        </h3>
                        <ScheduleTable :staff="taipeiStaff" :is-working-mode="isWorkingMode" :month-days="currentMonthDays" :mock-schedules="mockSchedules" location="Taipei" />
                    </div>

                    <div class="p-4 border border-gray-100 rounded-lg shadow-sm">
                        <h3 class="text-lg font-bold flex justify-between items-center mb-3">
                            å°ä¸­åº—ç­è¡¨
                            <span class="text-sm text-gray-500">å“¡å·¥äººæ•¸: {{ taichungStaff.length }}</span>
                        </h3>
                        <ScheduleTable :staff="taichungStaff" :is-working-mode="isWorkingMode" :month-days="currentMonthDays" :mock-schedules="mockSchedules" location="Taichung" />
                    </div>
                </div>

            </section>

            <section v-if="currentPage === 'æ¬¡æœˆç­è¡¨'" class="p-4">
                <NextMonthSchedule :current-year="currentYear" :next-month="nextMonth" :next-month-days="nextMonthDays" :taipei-staff="taipeiStaff" :taichung-staff="taichungStaff" :mock-schedules="mockSchedules" />
            </section>

            <section v-if="currentPage === 'æˆ‘è¦æ’ç­'" class="p-4">
                <ScheduleRequest :current-month="currentMonth" :current-year="currentYear" :current-month-days="currentMonthDays" @goto-home="currentPage = 'ç•¶æœˆç­è¡¨'" />
            </section>

            <section v-if="currentPage === 'æˆ‘è¦è«‹å‡'" class="p-4">
                <LeaveRequest @update-schedule="updateMockSchedules" />
            </section>

            <section v-if="currentPage === 'å¾Œå°ç®¡ç†'" class="p-4">
                <AdminPanel />
            </section>
        </div>
    </main>

    <transition name="slide">
        <div v-if="isMenuOpen" @click="toggleMenu" 
             class="fixed inset-0 bg-black bg-opacity-50 z-50">
            <div @click.stop 
                 class="fixed right-0 top-0 bottom-0 w-3/4 max-w-xs bg-white shadow-2xl p-6 pt-16">
                <ul class="space-y-4 text-lg">
                    <li v-for="page in pages" :key="page">
                        <button @click="navigateTo(page)" 
                                :class="{'font-bold text-dark-bg': currentPage === page}"
                                class="w-full text-left py-2 hover:bg-gray-50 rounded transition duration-150">
                            {{ page }}
                        </button>
                    </li>
                </ul>
            </div>
        </div>
    </transition>
</div>

<script type="module">
    const { createApp, ref, computed } = Vue;

    // --- è¼”åŠ©å‡½æ•¸ ---
    const getDaysInMonth = (year, month) => {
        // month is 1-indexed (Jan=1, Feb=2...)
        return new Date(year, month, 0).getDate();
    };

    // --- Component: æ’ç­è¡¨è¡¨æ ¼ (ScheduleTable) ---
    const ScheduleTable = {
        props: ['staff', 'isWorkingMode', 'monthDays', 'mockSchedules', 'location'],
        template: `
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider sticky left-0 bg-gray-50 z-30">å“¡å·¥</th>
                            <th v-for="day in monthDays" :key="day" class="px-3 py-2 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">
                                {{ day }}
                            </th>
                        </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200">
                        <tr v-for="employee in staff" :key="employee.id">
                            <td class="px-3 py-2 whitespace-nowrap text-sm font-medium sticky left-0 bg-white z-30"
                                :class="{ 'text-red-500': getDailyLeave(employee, day) }">
                                {{ employee.name }} 
                                <span v-if="getDailyLeave(employee, day)" class="text-xs font-semibold">({{ getDailyLeave(employee, day) }})</span>
                            </td>
                            <td v-for="day in monthDays" :key="day" class="px-3 py-2 whitespace-nowrap text-sm text-center">
                                <span v-if="getScheduleStatus(employee, day) === 'W' && isWorkingMode">å€¼</span>
                                <span v-else-if="getScheduleStatus(employee, day) === 'O' && !isWorkingMode">ä¼‘</span>
                                <span v-else-if="getScheduleStatus(employee, day) === 'L'">
                                    <span v-if="getDailyLeave(employee, day)" :class="{'text-red-500': isWorkingMode}">{{ getDailyLeave(employee, day) }}</span>
                                    <span v-else>
                                        {{ isWorkingMode ? '' : 'ä¼‘' }}
                                    </span>
                                </span>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        `,
        methods: {
            // æ¨¡æ“¬ç²å–å“¡å·¥æŸä¸€å¤©çš„æ’ç­ç‹€æ…‹: 'W'=å€¼ç­, 'O'=æ’ä¼‘, 'L'=è«‹å‡
            getScheduleStatus(employee, day) {
                const dateKey = `${new Date().getFullYear()}-${new Date().getMonth() + 1}-${day}`;
                const schedule = this.mockSchedules.find(s => 
                    s.employeeId === employee.id && s.date === dateKey
                );
                
                if (schedule) {
                    if (schedule.leaveType) return 'L'; // è«‹å‡
                    if (schedule.type === 'GeneralOff') return 'O'; // æ’ä¼‘
                }
                
                // æ¨¡æ“¬æœªæ’ç­é è¨­ç‚ºå€¼ç­ ('W')
                return 'W';
            },
            // ç²å–è«‹å‡é¡å‹ä¸¦é¡¯ç¤º
            getDailyLeave(employee, day) {
                 const dateKey = `${new Date().getFullYear()}-${new Date().getMonth() + 1}-${day}`;
                 const schedule = this.mockSchedules.find(s => 
                    s.employeeId === employee.id && s.date === dateKey && s.leaveType
                );
                if (!schedule) return null;
                
                // è½‰æ›è«‹å‡é¡å‹ç¸®å¯«
                const typeMap = { 'Sick': 'ç—…', 'Personal': 'äº‹' };
                return typeMap[schedule.leaveType] || null;
            }
        }
    };

    // --- Component: æ¬¡æœˆç­è¡¨ (NextMonthSchedule) ---
    const NextMonthSchedule = {
        props: ['currentYear', 'nextMonth', 'nextMonthDays', 'taipeiStaff', 'taichungStaff', 'mockSchedules'],
        components: { ScheduleTable },
        data() {
            return {
                isWorkingMode: true,
                isSchedulingOpen: false, // å‡è¨­ä»Šå¤©æ—¥æœŸæ˜¯25è™Ÿï¼Œæ‰€ä»¥æ’ç­æ˜¯é–‹æ”¾çš„
            }
        },
        mounted() {
            // æ¨¡æ“¬åˆ¤æ–·æ’ç­æ˜¯å¦é–‹æ”¾ (24è™Ÿåˆ°28è™Ÿ)
            const today = new Date().getDate();
            this.isSchedulingOpen = (today >= 24 && today <= 28);
        },
        template: `
            <div class="p-4">
                <h2 class="text-2xl font-bold mb-4">æ¬¡æœˆç­è¡¨</h2>

                <div class="text-center my-4 p-2 bg-light-gray rounded-lg">
                    <p class="text-xl font-medium">{{ nextMonth === 1 ? currentYear + 1 : currentYear }} å¹´ {{ nextMonth }} æœˆ</p>
                </div>
                
                <div v-if="!isSchedulingOpen" class="relative bg-gray-200 h-96 flex items-center justify-center rounded-lg overflow-hidden">
                    <div class="absolute inset-0 bg-white opacity-80 z-10"></div>
                    <p class="text-3xl font-bold text-gray-400 z-20" style="text-shadow: 1px 1px 2px rgba(0,0,0,0.1);">å°šæœªé–‹æ”¾æ’ç­</p>
                    
                    <div class="absolute inset-0 grid grid-cols-7 gap-1 p-2 text-gray-300 text-xs z-0">
                        <div v-for="i in nextMonthDays" :key="'d'+i" class="text-center">{{ i }}</div>
                    </div>
                </div>

                <div v-else>
                    <div class="flex justify-around bg-gray-100 p-1 rounded-full mb-6 shadow-inner">
                        <button 
                            @click="isWorkingMode = true"
                            :class="{'bg-white shadow-md text-dark-bg': isWorkingMode, 'text-gray-500': !isWorkingMode}"
                            class="flex-1 py-2 rounded-full font-medium transition duration-200">
                            å€¼ç­äººå“¡
                        </button>
                        <button 
                            @click="isWorkingMode = false"
                            :class="{'bg-white shadow-md text-dark-bg': !isWorkingMode, 'text-gray-500': isWorkingMode}"
                            class="flex-1 py-2 rounded-full font-medium transition duration-200">
                            ä¼‘å‡äººå“¡
                        </button>
                    </div>

                    <div class="grid grid-cols-1 gap-6">
                        <div class="p-4 border border-gray-100 rounded-lg shadow-sm">
                            <h3 class="text-lg font-bold flex justify-between items-center mb-3">
                                å°åŒ—åº—ç­è¡¨
                                <span class="text-sm text-gray-500">å“¡å·¥äººæ•¸: {{ taipeiStaff.length }}</span>
                            </h3>
                            <ScheduleTable :staff="taipeiStaff" :is-working-mode="isWorkingMode" :month-days="nextMonthDays" :mock-schedules="mockSchedules" location="Taipei" />
                        </div>
                    </div>
                </div>
            </div>
        `
    };

    // --- Component: æˆ‘è¦æ’ç­ (ScheduleRequest) ---
    const ScheduleRequest = {
        props: ['currentYear', 'currentMonth', 'currentMonthDays'],
        emits: ['gotoHome'],
        data() {
            return {
                isLoggedIn: false,
                employeeId: '',
                password: '',
                currentEmployee: {
                    name: 'ç‹å°æ˜', 
                    id: 'E001', 
                    maxOffDays: 8, // å¯æ’ä¼‘å¤©æ•¸
                    offDaysRequested: 0,
                },
                selectedDates: [],
                showLeaveModal: false,
                tempSelectedDate: null,
                leaveType: 'GeneralOff', // 1.ä¸€èˆ¬æ’ä¼‘, 2.äº‹å‡, 3.ç‰¹ä¼‘
                leaveOptions: [
                    { value: 'GeneralOff', label: 'ä¸€èˆ¬æ’ä¼‘' },
                    { value: 'Personal', label: 'äº‹å‡' },
                    { value: 'SpecialAnnual', label: 'ç‰¹ä¼‘' },
                ]
            }
        },
        computed: {
            remainingOffDays() {
                return this.currentEmployee.maxOffDays - this.selectedDates.length;
            },
            calendarGrid() {
                // ç°¡åŒ–ï¼šåªé¡¯ç¤ºä¸€å€‹æœˆçš„æ—¥æœŸ
                const days = [];
                for (let i = 1; i <= this.currentMonthDays; i++) {
                    days.push(i);
                }
                return days;
            }
        },
        methods: {
            handleLogin() {
                // æ¨¡æ“¬ç™»å…¥é‚è¼¯
                if (this.employeeId === 'E001' && this.password === '1234') {
                    this.isLoggedIn = true;
                    this.selectedDates = []; // æ¸…ç©ºå·²é¸æ—¥æœŸ
                } else {
                    alert('ç™»å…¥å¤±æ•—');
                }
            },
            toggleDateSelection(day) {
                const dateKey = `${this.currentYear}-${this.currentMonth}-${day}`;
                const index = this.selectedDates.indexOf(dateKey);

                if (index > -1) {
                    // å–æ¶ˆé¸å–
                    this.selectedDates.splice(index, 1);
                } else {
                    // é»æ“Šé¸å–
                    this.tempSelectedDate = dateKey;
                    this.showLeaveModal = true;
                }
            },
            isDateSelected(day) {
                const dateKey = `${this.currentYear}-${this.currentMonth}-${day}`;
                return this.selectedDates.includes(dateKey);
            },
            confirmLeaveType() {
                if (this.leaveType === 'GeneralOff' && this.selectedDates.length >= this.currentEmployee.maxOffDays) {
                    alert('æ‚¨çš„ä¼‘å‡å¤©æ•¸å·²æ»¿ï¼Œè«‹é¸æ“‡å…¶ä»–å‡åˆ¥');
                    return;
                }
                
                // ç¢ºå®šé¸å–
                if (this.tempSelectedDate && !this.selectedDates.includes(this.tempSelectedDate)) {
                    this.selectedDates.push(this.tempSelectedDate);
                }
                this.showLeaveModal = false;
                this.tempSelectedDate = null;
            },
            submitSchedule() {
                if (this.selectedDates.length === 0) {
                    alert('è«‹é¸æ“‡æ‚¨è¦æ’ä¼‘çš„æ—¥æœŸï¼');
                    return;
                }
                
                // æ¨¡æ“¬é€å‡ºæ’ç­è³‡æ–™åˆ°å¾Œç«¯ (é€™è£¡æœƒéœ€è¦å¯¦éš›çš„ API)
                console.log('é€å‡ºæ’ç­ç”³è«‹ï¼š', this.selectedDates);
                alert('æ’ç­ç”³è«‹å·²æˆåŠŸé€å‡ºï¼');
                
                // é€å‡ºå¾Œè·³å›é¦–é 
                this.$emit('gotoHome');
            }
        },
        template: `
            <div>
                <h2 class="text-2xl font-bold mb-4">æˆ‘è¦æ’ç­</h2>
                
                <div v-if="!isLoggedIn" class="space-y-4 p-6 bg-gray-50 rounded-lg shadow-md">
                    <input v-model="employeeId" type="text" placeholder="å“¡å·¥ç·¨è™Ÿ" class="w-full p-3 border rounded-lg focus:ring-accent-red focus:border-accent-red">
                    <input v-model="password" type="password" placeholder="å¯†ç¢¼" class="w-full p-3 border rounded-lg focus:ring-accent-red focus:border-accent-red">
                    <button @click="handleLogin" class="w-full bg-dark-bg text-white py-3 rounded-lg font-semibold hover:bg-gray-700 transition duration-150">
                        ç™» å…¥
                    </button>
                </div>
                
                <div v-else>
                    <div class="flex justify-around p-3 bg-gray-100 rounded-lg mb-4 text-center">
                        <div>
                            <p class="text-xs text-gray-500">æ¯æœˆå¯æ’ä¼‘å¤©æ•¸</p>
                            <p class="text-xl font-bold">{{ currentEmployee.maxOffDays }} å¤©</p>
                        </div>
                        <div>
                            <p class="text-xs text-gray-500">å‰©é¤˜å¯æ’ä¼‘å¤©æ•¸</p>
                            <p class="text-xl font-bold text-accent-red">{{ remainingOffDays }} å¤©</p>
                        </div>
                    </div>
                    
                    <div class="p-4 bg-white rounded-lg shadow-lg">
                        <div class="text-center text-xl font-semibold mb-3">{{ currentYear }}å¹´ {{ currentMonth }}æœˆ</div>
                        <div class="grid grid-cols-7 text-center text-sm font-medium text-gray-500 border-b pb-2 mb-2">
                            <span>æ—¥</span><span>ä¸€</span><span>äºŒ</span><span>ä¸‰</span><span>å››</span><span>äº”</span><span>å…­</span>
                        </div>
                        
                        <div class="grid grid-cols-7 gap-1">
                            <div v-for="day in calendarGrid" :key="day" 
                                 @click="toggleDateSelection(day)"
                                 class="aspect-square flex flex-col items-center justify-center p-1 rounded-lg transition duration-100 cursor-pointer"
                                 :class="{
                                     'bg-gray-200': isDateSelected(day),
                                     'hover:bg-gray-100': !isDateSelected(day)
                                 }">
                                <span class="text-lg font-semibold">{{ day }}</span>
                                <span class="text-xs text-gray-500 mt-1">
                                    <span v-if="isDateSelected(day)">{{ currentEmployee.name }}</span> 
                                    <span v-else>...</span>
                                </span>
                            </div>
                        </div>
                    </div>
                    
                    <div v-if="showLeaveModal" class="fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50">
                        <div class="bg-white p-6 rounded-xl shadow-2xl w-11/12 max-w-sm">
                            <h3 class="text-lg font-bold mb-4">é¸æ“‡å‡åˆ¥</h3>
                            <div class="space-y-3">
                                <div v-for="option in leaveOptions" :key="option.value" class="flex items-center">
                                    <input type="radio" :id="option.value" :value="option.value" v-model="leaveType" class="text-accent-red focus:ring-accent-red">
                                    <label :for="option.value" class="ml-3 text-base">{{ option.label }}</label>
                                </div>
                            </div>
                            <div class="mt-6 flex justify-end space-x-3">
                                <button @click="showLeaveModal = false" class="px-4 py-2 text-gray-600 rounded-lg hover:bg-gray-100">å–æ¶ˆ</button>
                                <button @click="confirmLeaveType" class="px-4 py-2 bg-accent-red text-white rounded-lg hover:bg-red-600 transition duration-150">ç¢ºèª</button>
                            </div>
                        </div>
                    </div>
                    
                    <button @click="submitSchedule" class="w-full bg-accent-red text-white py-3 rounded-lg font-semibold mt-6 hover:bg-red-600 transition duration-150">
                        ç¢ºèªé€å‡ºç­è¡¨
                    </button>
                </div>
            </div>
        `
    };

    // --- Component: æˆ‘è¦è«‹å‡ (LeaveRequest) ---
    const LeaveRequest = {
        emits: ['updateSchedule'],
        data() {
            return {
                isLoggedIn: false,
                employeeId: '',
                password: '',
                selectedDate: null,
                leaveHour: '8.0',
                leaveType: 'Sick', // ç—…å‡, äº‹å‡
                receiptFile: null,
                showAlert: false,
                leaveHoursOptions: [
                    '1.0', '1.5', '2.0', '2.5', '3.0', '3.5', '4.0', '4.5', 
                    '5.0', '5.5', '6.0', '6.5', '7.0', '7.5', '8.0', '8.5', 
                    'æ•´å¤©'
                ],
                leaveTypeOptions: [
                    { value: 'Sick', label: 'ç—…å‡' },
                    { value: 'Personal', label: 'äº‹å‡' },
                ]
            }
        },
        methods: {
            handleLogin() {
                // æ¨¡æ“¬ç™»å…¥é‚è¼¯
                if (this.employeeId === 'E001' && this.password === '1234') {
                    this.isLoggedIn = true;
                } else {
                    alert('ç™»å…¥å¤±æ•—');
                }
            },
            handleFileUpload(event) {
                this.receiptFile = event.target.files[0];
            },
            submitLeave() {
                if (!this.selectedDate || !this.leaveHour || !this.leaveType) {
                    alert('è«‹å¡«å¯«å®Œæ•´çš„è«‹å‡è³‡è¨Šã€‚');
                    return;
                }
                if (this.leaveType === 'Sick' && !this.receiptFile) {
                    alert('ç—…å‡è«‹å‹™å¿…ä¸Šå‚³çœ‹è¨ºæ”¶æ“šã€‚');
                    return;
                }

                // æ¨¡æ“¬é€å‡ºè«‹å‡è³‡æ–™
                const leaveData = {
                    date: this.selectedDate,
                    employeeId: this.employeeId,
                    leaveHour: this.leaveHour,
                    leaveType: this.leaveType,
                    receipt: this.receiptFile ? this.receiptFile.name : 'ç„¡',
                    status: 'Pending'
                };
                
                console.log('è«‹å‡ç”³è«‹é€å‡ºï¼š', leaveData);
                
                // è§¸ç™¼ App å¯¦ä¾‹æ›´æ–° MockSchedulesï¼Œæ¨¡æ“¬ç­è¡¨å³æ™‚æ›´æ–°
                this.$emit('updateSchedule', leaveData);

                this.showAlert = true;
                setTimeout(() => {
                    this.showAlert = false;
                }, 3000);

                // é‡è¨­è¡¨å–®
                this.selectedDate = null;
                this.leaveHour = '8.0';
                this.leaveType = 'Sick';
                this.receiptFile = null;
            }
        },
        template: `
            <div>
                <h2 class="text-2xl font-bold mb-4">æˆ‘è¦è«‹å‡</h2>
                
                <div v-if="!isLoggedIn" class="space-y-4 p-6 bg-gray-50 rounded-lg shadow-md">
                    <input v-model="employeeId" type="text" placeholder="å“¡å·¥ç·¨è™Ÿ" class="w-full p-3 border rounded-lg">
                    <input v-model="password" type="password" placeholder="å¯†ç¢¼" class="w-full p-3 border rounded-lg">
                    <button @click="handleLogin" class="w-full bg-dark-bg text-white py-3 rounded-lg font-semibold">ç™» å…¥</button>
                </div>

                <div v-else class="space-y-6">
                    <div class="bg-white p-4 rounded-lg shadow-lg">
                        <label class="block text-lg font-semibold mb-2">è«‹é¸æ“‡è«‹å‡æ—¥æœŸ</label>
                        <input type="date" v-model="selectedDate" class="w-full p-3 border rounded-lg focus:ring-accent-red focus:border-accent-red">
                    </div>

                    <div class="bg-white p-4 rounded-lg shadow-lg">
                        <label class="block text-lg font-semibold mb-2">è«‹å‡æ™‚æ•¸/æ•´å¤©</label>
                        <select v-model="leaveHour" class="w-full p-3 border rounded-lg focus:ring-accent-red focus:border-accent-red appearance-none">
                            <option v-for="hour in leaveHoursOptions" :key="hour" :value="hour">{{ hour }} å°æ™‚</option>
                        </select>
                    </div>

                    <div class="bg-white p-4 rounded-lg shadow-lg">
                        <label class="block text-lg font-semibold mb-2">é¸æ“‡å‡åˆ¥</label>
                        <div class="flex space-x-4">
                            <div v-for="option in leaveTypeOptions" :key="option.value" class="flex items-center">
                                <input type="radio" :id="'leaveType-' + option.value" :value="option.value" v-model="leaveType" class="text-accent-red focus:ring-accent-red">
                                <label :for="'leaveType-' + option.value" class="ml-2">{{ option.label }}</label>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white p-4 rounded-lg shadow-lg">
                        <label class="block text-lg font-semibold mb-2">ä¸Šå‚³çœ‹è¨ºæ”¶æ“š</label>
                        <label for="receipt-upload" class="block w-full text-center py-3 border border-dashed border-gray-400 text-gray-600 rounded-lg cursor-pointer hover:bg-gray-50 transition duration-150">
                            <span v-if="receiptFile">{{ receiptFile.name }} (å·²é¸å–)</span>
                            <span v-else>é»æ“Šä¸Šå‚³çœ‹è¨ºæ”¶æ“š</span>
                            <input type="file" id="receipt-upload" @change="handleFileUpload" accept="image/*,.pdf" class="hidden">
                        </label>
                        <p v-if="leaveType === 'Sick'" class="text-sm text-red-500 mt-2">è«‹å‡é¡å‹ç‚ºç—…å‡æ™‚å¿…å¡«ã€‚</p>
                    </div>

                    <button @click="submitLeave" class="w-full bg-accent-red text-white py-3 rounded-lg font-semibold hover:bg-red-600 transition duration-150">
                        ç¢ºèªé€å‡ºè«‹å‡
                    </button>
                    
                    <div v-if="showAlert" class="fixed bottom-4 right-4 bg-green-500 text-white p-3 rounded-lg shadow-xl transition duration-300">
                        è«‹å‡ç”³è«‹å·²é€å‡ºï¼ç­è¡¨å·²æ›´æ–°ã€‚
                    </div>
                </div>
            </div>
        `
    };

    // --- Component: å¾Œå°ç®¡ç† (AdminPanel) ---
    const AdminPanel = {
        data() {
            return {
                isLoggedIn: false,
                adminAccount: '',
                adminPassword: '',
            }
        },
        methods: {
            handleLogin() {
                // æ¨¡æ“¬ç®¡ç†å“¡ç™»å…¥
                if (this.adminAccount === 'admin' && this.adminPassword === 'admin123') {
                    this.isLoggedIn = true;
                } else {
                    alert('ç®¡ç†å“¡å¸³è™Ÿæˆ–å¯†ç¢¼éŒ¯èª¤');
                }
            }
        },
        template: `
            <div>
                <h2 class="text-2xl font-bold mb-4">å¾Œå°ç®¡ç†</h2>
                
                <div v-if="!isLoggedIn" class="space-y-4 p-6 bg-gray-50 rounded-lg shadow-md">
                    <input v-model="adminAccount" type="text" placeholder="ç®¡ç†å“¡å¸³è™Ÿ" class="w-full p-3 border rounded-lg">
                    <input v-model="adminPassword" type="password" placeholder="å¯†ç¢¼" class="w-full p-3 border rounded-lg">
                    <button @click="handleLogin" class="w-full bg-dark-bg text-white py-3 rounded-lg font-semibold">ç™» å…¥</button>
                    <div class="flex justify-between text-sm mt-3">
                        <a href="#" class="text-accent-red hover:underline">å‰µå»ºå¸³è™Ÿ</a>
                        <a href="#" class="text-accent-red hover:underline">å¿˜è¨˜å¯†ç¢¼</a>
                    </div>
                </div>
                
                <div v-else class="space-y-6">
                    <div class="grid grid-cols-2 gap-4">
                        <button class="p-4 bg-gray-100 rounded-lg shadow hover:bg-gray-200">ğŸ“Š çµ±è¨ˆå ±è¡¨</button>
                        <button class="p-4 bg-gray-100 rounded-lg shadow hover:bg-gray-200">ğŸ‘¤ å“¡å·¥è³‡æ–™å‰µå»º</button>
                        <button class="p-4 bg-gray-100 rounded-lg shadow hover:bg-gray-200">ğŸ“œ æŸ¥çœ‹å‡ºå‹¤è³‡æ–™</button>
                        <button class="p-4 bg-gray-100 rounded-lg shadow hover:bg-gray-200">âœï¸ ç·¨è¼¯å“¡å·¥ç­è¡¨</button>
                    </div>
                    
                    <div class="p-4 bg-white rounded-lg shadow-lg">
                        <h3 class="text-lg font-bold mb-3">ç´¯ç©è³‡æ–™ (ç•¶æœˆ/å¹´åº¦)</h3>
                        <ul class="space-y-2 text-sm">
                            <li class="flex justify-between py-1 border-b"><span>ä¼‘å‡å¤©æ•¸</span><span class="font-semibold">8 / 96 å¤©</span></li>
                            <li class="flex justify-between py-1 border-b"><span>ç—…å‡å¤©æ•¸</span><span class="font-semibold">1 / 5 å¤© <button class="text-accent-red text-xs ml-2 hover:underline">æŸ¥çœ‹æ”¶æ“š</button></span></li>
                            <li class="flex justify-between py-1 border-b"><span>äº‹å‡å¤©æ•¸</span><span class="font-semibold">0 / 3 å¤©</span></li>
                            <li class="flex justify-between py-1"><span>åŠ ç­æ™‚æ•¸</span><span class="font-semibold text-green-600">4 å°æ™‚</span></li>
                        </ul>
                    </div>

                    <div class="p-4 bg-white rounded-lg shadow-lg">
                         <h3 class="text-lg font-bold mb-3">å‰µå»ºå“¡å·¥è³‡æ–™</h3>
                         <input type="text" placeholder="(1) å“¡å·¥ç·¨è™Ÿ" class="w-full p-2 border rounded-lg mb-2">
                         <input type="password" placeholder="(2) å¯†ç¢¼" class="w-full p-2 border rounded-lg mb-2">
                         <input type="text" placeholder="(3) å“¡å·¥åç¨±" class="w-full p-2 border rounded-lg mb-2">
                         <div class="flex space-x-4 mb-2">
                            <label><input type="checkbox" class="text-dark-bg"> å°åŒ—åº—</label>
                            <label><input type="checkbox" class="text-dark-bg"> å°ä¸­åº—</label>
                         </div>
                         <input type="number" placeholder="(5) å¯æ’ä¼‘å¤©æ•¸" class="w-full p-2 border rounded-lg mb-3">
                         <button class="w-full bg-dark-bg text-white py-2 rounded-lg">å‰µå»ºå“¡å·¥</button>
                    </div>
                </div>
            </div>
        `
    };

    // --- Vue App å¯¦ä¾‹ ---
    const App = {
        components: {
            ScheduleTable,
            NextMonthSchedule,
            ScheduleRequest,
            LeaveRequest,
            AdminPanel
        },
        data() {
            const today = new Date();
            const currentMonth = today.getMonth() + 1;
            const currentYear = today.getFullYear();
            
            return {
                currentPage: 'ç•¶æœˆç­è¡¨',
                pages: ['ç•¶æœˆç­è¡¨', 'æ¬¡æœˆç­è¡¨', 'æˆ‘è¦æ’ç­', 'æˆ‘è¦è«‹å‡', 'å¾Œå°ç®¡ç†'],
                isMenuOpen: false,
                isWorkingMode: true, // true: å€¼ç­äººå“¡, false: ä¼‘å‡äººå“¡
                currentYear,
                currentMonth,
                
                // --- Mock Data æ¨¡æ“¬å¾Œç«¯è³‡æ–™åº« ---
                staff: [
                    { id: 'E001', name: 'ç‹å°æ˜', location: 'Taipei' },
                    { id: 'E002', name: 'é™³å¤§è¯', location: 'Taipei' },
                    { id: 'E003', name: 'æç¾ç¾', location: 'Taichung' },
                    { id: 'E004', name: 'å³é˜¿ä¸­', location: 'Taichung' },
                ],
                // æ¨¡æ“¬ç­è¡¨: { employeeId: 'E001', date: '2025-12-5', type: 'GeneralOff'/'SpecialAnnual'/'Sick'/'Personal', leaveType: 'Sick'/'Personal' }
                mockSchedules: [
                    // ç¯„ä¾‹ï¼šE001 12æœˆ5è™Ÿ æ’ä¼‘
                    { employeeId: 'E001', date: `${currentYear}-${currentMonth}-5`, type: 'GeneralOff' },
                    // ç¯„ä¾‹ï¼šE002 12æœˆ6è™Ÿ è«‹ç—…å‡
                    { employeeId: 'E002', date: `${currentYear}-${currentMonth}-6`, type: 'Leave', leaveType: 'Sick' },
                    // ç¯„ä¾‹ï¼šE003 12æœˆ10è™Ÿ è«‹äº‹å‡
                    { employeeId: 'E003', date: `${currentYear}-${currentMonth}-10`, type: 'Leave', leaveType: 'Personal' },
                ]
            };
        },
        computed: {
            currentMonthDays() {
                return getDaysInMonth(this.currentYear, this.currentMonth);
            },
            nextMonth() {
                return this.currentMonth === 12 ? 1 : this.currentMonth + 1;
            },
            nextMonthDays() {
                const year = this.currentMonth === 12 ? this.currentYear + 1 : this.currentYear;
                return getDaysInMonth(year, this.nextMonth);
            },
            taipeiStaff() {
                return this.staff.filter(s => s.location === 'Taipei');
            },
            taichungStaff() {
                return this.staff.filter(s => s.location === 'Taichung');
            }
        },
        methods: {
            toggleMenu() {
                this.isMenuOpen = !this.isMenuOpen;
            },
            navigateTo(page) {
                this.currentPage = page;
                this.isMenuOpen = false;
            },
            // è™•ç†è«‹å‡ç”³è«‹é€å‡ºå¾Œï¼Œæ›´æ–°ç­è¡¨è³‡æ–™ (Mock)
            updateMockSchedules(leaveData) {
                // å°‡æ—¥æœŸæ ¼å¼è½‰æ›ç‚º YYYY-MM-DD
                const dateParts = leaveData.date.split('-');
                const formattedDate = `${dateParts[0]}-${parseInt(dateParts[1])}-${parseInt(dateParts[2])}`;

                // æª¢æŸ¥æ˜¯å¦å·²å­˜åœ¨è©²æ—¥çš„æ’ç­/è«‹å‡ç´€éŒ„
                const existingIndex = this.mockSchedules.findIndex(s => 
                    s.employeeId === leaveData.employeeId && s.date === formattedDate
                );

                const newSchedule = {
                    employeeId: leaveData.employeeId,
                    date: formattedDate,
                    type: 'Leave',
                    leaveType: leaveData.leaveType,
                    // å¯¦éš›é‚„éœ€å„²å­˜æ™‚æ•¸ã€æ”¶æ“šç­‰
                };
                
                if (existingIndex > -1) {
                    // è¦†è“‹ç¾æœ‰ç´€éŒ„
                    this.mockSchedules[existingIndex] = newSchedule;
                } else {
                    // åŠ å…¥æ–°ç´€éŒ„
                    this.mockSchedules.push(newSchedule);
                }
            }
        },
        mounted() {
            // ç¢ºä¿æ‰‹æ©Ÿä»‹é¢ (Tailwind çš„ max-w-screen-md)
            document.body.style.backgroundColor = getComputedStyle(document.documentElement).getPropertyValue('--color-primary-dark');
        }
    };

    createApp(App).mount('#app');
</script>

</body>
</html>
